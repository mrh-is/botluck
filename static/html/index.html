<!DOCTYPE html>
<html>
	<header>
		<title>Login</title>
		<link rel="stylesheet" type="text/css" href="/static/styles/style.css">
		<link href='http://fonts.googleapis.com/css?family=Roboto:300italic,400italic,400,700,300' rel='stylesheet' type='text/css'>

		<script type="text/javascript" src="/static/js/jquery-1.9.0.js"></script>
		<script type="text/javascript" src="/static/js/Ingredient.js"></script>
		<script type="text/javascript" src="/static/js/Utensil.js"></script>
		<script type="text/javascript" src="/static/js/Meal.js"></script>
		<script type="text/javascript" src="/static/js/User.js"></script>
	</header>
	<body>
	<div id="headerBar">
		<div class="wrapper headerText"><br>Welcome to Botluck!</div>
	</div>
	<div id="headerBar2">
	</div>
	<div class="wrapper">
		<div class="login-form">
			<br><br><br>
			<h1>Login or join here</h1>
			<br><br><br>
			<form action="/static/home.html">
				<input id="username-input" type="textarea" value="username"/>
				<br>
				<input id="password-input" type="textarea" value="password"/>
				<br>
				<input id="loginBttn" type="button" value="Login"/> 
				<input id="signUpBttn" type="button" value="Sign Up"/> 
			</form>
		</div>
		<div class="login-form">
			<form id="signup-form" style="display: none">
				<h3> What's your name? <h3>
				<input id="new-name-input" type="textarea" value=""/>
				<br>
				<h3> Choose your username </h3>
				<input id="new-username-input" type="textarea" value=""/>
				<br>
				<h3> Choose a password </h3>
				<input id="new-password-input" type="textarea" value=""/>
				<br>
				<input id="createNewUserBttn" type="button" value="Create New User"/>
				<br>
			</form>
		</div>
		<div id='success-message'></div>
		<br><br><br> 
	</div>
	<div id="footerBar2"></div>
	<div id="footerBar"></div>
	<script type="text/javascript">
		$('#loginBttn').click(function() {
			var username = $('#username-input').val();
			var password = $('#password-input').val();
			if (username === undefined || password === undefined ||
				username === "" || password === "") {
				return;
			}
			$.ajax({
					type: "post",
					data: {
						"username": username, 
						"password": password
					},
					url: "/verify",
					success: function(data) {
						if (data.success) {
							window.location.href = "/static/home.html?id=" + data.uid;
						} else {
							$('#success-message').html("The username and password are incorrect.");
						}
					}
				});
		});

		/* display sign up form */
		$('#signUpBttn').click(function() {
			$('#signup-form').show();
		});

		/* create new user */
		$('#createNewUserBttn').click(function() {
			var name = $('#new-name-input').val();
			var username = $('#new-username-input').val();
			var password = $('#new-password-input').val();
			$.ajax({
				type: "post",
				url: "/user",
				data: {
					"username": username,
					"password": password,
					"name": name
				},
				success: function(data) {
					if (data.success) { // successfully created user
						$('#success-message').html("Success! You will be redirected in a few seconds...").delay(2500);
						window.location.href = "/static/home.html?id=" + data.uid;
					} else if (data.usernameChosen) {
						$('#success-message').html("The username you have requested is already in use.");
					} else {
						$('#success-message').html("There was an error contacting the server. Please refresh and try again.");
					}
				}
			});
		});
	</script>
	</body>
</html>