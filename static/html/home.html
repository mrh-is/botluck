<!DOCTYPE html>
<html>
<header>
	<title>My Botluck</title>
	<link rel="stylesheet" type="text/css" href="/static/styles/style.css">
	<link href='http://fonts.googleapis.com/css?family=Roboto:300italic,400italic,400,700,300' rel='stylesheet' type='text/css'>

	<script type="text/javascript" src="js/jquery-1.9.0.js"></script>
	<script type="text/javascript" src="js/Ingredient.js"></script>
	<script type="text/javascript" src="js/Utensil.js"></script>
	<script type="text/javascript" src="js/User.js"></script>
	<script type="text/javascript" src="js/MealFinder.js"></script>

</header>
<body>
	<div id="headerBar">
		<div class="wrapper headerText">A more stylized Botluck	logo of some kind <span class="subHeaderText">and a robot</span> !</div>
	</div>
	<div id="headerBar2">
	</div>

	<div class="wrapper">
		<h1 id="welcome-message"></h1>
		<div id="mainCol">
			<h2>New Invitations</h2>
			<div id="invitations">
				<div class="invitation-top"></div>
				<div class="invitation">
					<div class="icon"><img src="/static/assets/invitation-icon.png"></div>
					<div class="content">
						<div class="date">Feb 2</div>
						<div>Katy Perry has invited you to a botluck</div>
					</div>
					<button class="navButton" type="button">view</button>
				</div>
				<div class="invitation">
					<div class="icon"><img src="/static/assets/invitation-icon.png"></div>
					<div class="content">
						<div class="date">Jan 31</div>
						<div>Barack Obama has invited you to a botluck</div>
					</div>
					<button class="navButton" type="button">view</button>
				</div>
			</div>
			<h2>Upcoming Botlucks</h2>
			<div id="currentmeals">
				<div class="meal">
					<div class="date">Feb 26</div>
					<div class="photo">a meal photo</div>
					<div>
						<div class="caption">Jay-Z's Birthday Botluck</div>
						<div class="menu">
							<span class="date">menu</span>
							<span>Linguini</span><br>
						</div>
						<div class="date bringing">i'm bringing</div>
						<div class="contributions">
							<div class="contribution">
								<div class="photo">a food photo</div>
								<div class="caption">tomato sauce</div>
							</div>
							<div class="contribution">
								<div class="photo">a food photo</div>
								<div class="caption">pasta</div>
							</div>
						</div>
						<div class="right"><button class="navButton" type="button">view</button></div>
					</div>
				</div>
				<div class="meal">
					<div class="date">Mar 2</div>
					<div class="photo">a meal photo</div>
					<div>
						<div class="caption">Lady Gaga's Muppet Botluck</div>
						<div class="menu">
							<span class="date">menu</span>
							<span>Sashimi</span><br>
						</div>
						<div class="date bringing">i'm bringing</div>
						<div class="contributions">
							<div class="contribution">
								<div class="photo">a food photo</div>
								<div class="caption">tuna</div>
							</div>
							<div class="contribution">
								<div class="photo">a food photo</div>
								<div class="caption">albacore</div>
							</div>
							<div class="contribution">
								<div class="photo">a food photo</div>
								<div class="caption">salmon</div>
							</div>
							<div class="contribution">
								<div class="photo">a food photo</div>
								<div class="caption">salt</div>
							</div>
						</div>
						<div class="right"><button class="navButton" type="button">view</button></div>
					</div>
				</div>
				<div class="meal">
					<div class="date">Some other date</div>
					<div class="photo">a meal photo</div>
					<div>
						<div class="caption">Some Other Botluck</div>
						<div class="menu">
							<span class="date">menu</span>
							<span>Some Other Recipe</span><br>
						</div>
						<div class="date bringing">i'm bringing</div>
						<div class="contributions">
							<div class="contribution">
								<div class="photo">a food photo</div>
								<div class="caption">some other ingredient</div>
							</div>
							<div class="contribution">
								<div class="photo">a food photo</div>
								<div class="caption">Yet another ingredient</div>
							</div>
						</div>
						<div class="right"><button class="navButton" type="button">view</button></div>
					</div>
				</div>

			</div>
			<div id="columnEnd">
				<button class="navButton" type="button">view past botlucks</button>
			</div>
		</div>

		<div id="leftnav">
			<button class="navButton" type="button">start a botluck</button>
			<br><br>
			<!-- <h2>My Botluck</h2> -->
			<!-- <div class="photo">avatar</div>
			<div class="caption">Beyonce Knowles</div> -->
			<div id="karmaBadge">78</div>
			<h2>Contribute to more botlucks to earn more karma points!</h2>
			<button id="myBotlucksBttn" class="navButton" type="button">my botlucks</button>
			<button id="myKitchenBttn" class="navButton" type="button">my kitchen</button>
			<button id="myFriendsBttn" class="navButton" type="button">my friends</button>
		</div>

		<div id="pageEnd"></div>

	</div>

	<div id="footerBar2"></div>
	<div id="footerBar"></div>

	<script>
		// populates page data from the user object
		var user;

		var populatePageData = function(user) {

			/*user.addInvite(new Invite(5, "Mishq", 4, "Feb 4"));
			user.addInvite(new Invite(2, "Beyonce", 3, "Jan 29"));

			var m = new Meal(4, 3, "Jack's Dinner Party", [1,4,3], "Feb 6");
			m.contributions[user.id] = [user.ingredients[0]];
			user.addMeal(m);
			m = new Meal(4, 3, "MadHatter's Tea Party", [4,2,1], "Oct 20", "Tea and Biscuits");
			m.contributions[user.id] = [user.ingredients[1]];
			user.addMeal(m);
			user.karma = 10;*/

			$("#welcome-message").html("Welcome, " + user.name + "!");
			$("#karmaBadge").html(user.karma);

			user.invites.forEach(function(i) {
				addInvite(i);
			});

			user.currentMeals.forEach(function(meal) {
				addMeal(meal);
			});

		};

		// populate invites
		var addInvite = function(invite) {
			var mainDiv = $("<div class=\"invitation\">");
			$("<img src=\"static/assets/invitation-icon.png\">")
				.appendTo($("<div class=\"icon\">"))
				.appendTo(mainDiv);
			var content = $("<div>").addClass("content");
			$("<div>").addClass("date").html(invite.date).appendTo(content);
			$("<div>").html(invite.username + " has invited you to a botluck").appendTo(content);
			content.appendTo(mainDiv);
			var btn = $("<button class=\"navButton\" type=\"button\">").html("view");
			// set it such that clicking the button takes them to the meal page
			(function() {
				var mealId = invite.mealId;
				btn.click(function() {
					window.location.href = "/home/meal.html?uid=" + user.id + "&mid=" + mealId;
				});
			})();
			btn.appendTo(mainDiv);
			mainDiv.appendTo($("#invitations"));
		}

		// populate current meals
		var addMeal = function(meal) {
			var mainDiv = $("<div>").addClass("meal");
			$("<div>").addClass("date").html(meal.date).appendTo(mainDiv);
			$("<div>").addClass("photo").html("a meal photo").appendTo(mainDiv);
			var wrapper = $("<div>");
			$("<div>").addClass("caption").html(meal.name).appendTo(wrapper);
			var menu = $("<div>").addClass("menu");
			$("<span>").addClass("date").html("menu").appendTo(menu);
			$("<span>").html(meal.choice).appendTo(menu);
			menu.appendTo(wrapper);
			$("<div>").addClass("date bringing").html("i'm bringing").appendTo(wrapper);
			var contributionDiv = $("<div>").addClass("contributions");
			var contributions = meal.contributions[user.id];
			console.log(contributions);
			contributions.forEach(function(ingredient) {
				var div = $("<div>").addClass("contribution")
				$("<div>").addClass("photo").html("a food photo").appendTo(div);
				$("<div>").addClass("caption").html(ingredient.name).appendTo(div);
				div.appendTo(contributionDiv);
			});
			contributionDiv.appendTo(wrapper);
			var btn = $("<button class=\"navButton\" type=\"button\">").html("view");
			(function() {
				var mealId = meal.mealId;
				btn.click(function() {
					window.location.href = "/home/meal.html?uid=" + user.id + "&mid=" + mealId;
				});
			})();
			btn.appendTo($("<div>").addClass("right").appendTo(wrapper));
			wrapper.appendTo(mainDiv);
			mainDiv.appendTo($("#currentmeals"));
		};

		// set the nav bar buttons on the right
		$("#myBotlucksBttn").click(function() {
			// go to your botluck page
		});

		$("#myKitchenBttn").click(function() {
			window.location.href = "/static/home/mykitchen.html?id=" + user.id;
		});

		$("#myFriendsBttn").click(function() {
			// go to some friends page
		});

		// on load, the user is initialized from the server
		// and populatePageData is called
		window.onload = function() {
			var url = window.location.href;
			var i = url.indexOf("id=");
			if (i === -1) {
				console.log("You were redirected to home without a vaild user id");
				return;
			}
			id = parseInt(url.substring(i+3));
			if (id === NaN) {
				console.log("You were redirected to home without a vaild user id");
				return;
			}

			user = new User();
			user.initFromServer(id, populatePageData);
		};

	</script>
</body>
</html>